@model MaxPainInfrastructure.Models.State
    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    // https://developers.google.com/chart/interactive/docs/printing

    google.charts.load("current", { packages: ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
        $.get('/api/chart/openinterestjson/@Model.Ticker?m=@Model.MaturityEncoded', function (info) {

            var options = {
                title: info.title,
                colors: [info.series[0].color, info.series[1].color],
                vAxis: { title: info.vAxisTitle },
                hAxis: { title: info.hAxisTitle, gridlines: { count: info.series[0].points.length }, slantedText: true, slantedTextAngle: 45 },
                width: info.Width,
                height: info.Height
            };

            var data = new google.visualization.arrayToDataTable(info.dataArray);

            var chart;
            if (info.chartType == "line") chart = new google.visualization.LineChart(document.body);
            if (info.chartType == "stackedcolumn") chart = new google.visualization.ColumnChart(document.body);

            /*
            // Wait for the chart to finish drawing before calling the getImageURI() method.
            google.visualization.events.addListener(chart, 'ready', function () {
                var content = chart.getImageURI();
                var base64 = content.replace(/^data:application\/[^,]+,/, '');
                console.log(base64)
                Upload(base64);
            });
            */
            chart.draw(data, options);
        })
    }

    function Upload(content) {
        var formdata = new FormData();
        formdata.append("base64", content);

        $.ajax({
            url: "/api/chart/upload",
            type: 'POST',
            data: formdata,
            processData: false,
            contentType: false,
            success: function (data) {
                //code
            },
            error: function (error) {
                //code
            }
        });
    }
</script>
